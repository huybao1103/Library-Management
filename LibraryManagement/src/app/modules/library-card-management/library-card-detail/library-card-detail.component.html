<div class="mx-4">
    <h3 class="page-title">Library Card</h3>
    <h4>Detail Information</h4>
    <div class="row border p-3 profile" *ngIf="libraryCard$ | async as libraryCard">
        <div class="col-2 vertical-center">
            <div>
                <p-galleria [value]="libraryCard.studentImages" [circular]="true" [showThumbnails]="false"
                    [containerStyle]="{ 'max-width': '500px' }">
                    <ng-template pTemplate="item" let-item>
                        <img [src]="item.base64" class="rsp-Image" />
                    </ng-template>
                </p-galleria>
            </div>
        </div>
        <div class="col-3 vertical-center">
            <div class="text-truncate" style="overflow: hidden">
                <p>Name: {{ libraryCard.name }}</p>
                <p>Class: {{ libraryCard.class }}</p>
                <p>Expiry Date: {{ libraryCard.expiryDate | date: 'dd/MM/yyyy' }}</p>
            </div>
        </div>
        <div class="column-border-right col-1"></div>
        <div class="col-5 vertical-center">
            <div class="text-truncate" style="overflow: hidden">
                <p>Status: {{ libraryCard.status }}</p>
                <p>Description: {{ libraryCard.description }}</p>
                <p>student ID: {{ libraryCard.studentId }}</p>
            </div>
        </div>
        <div class="col-1" style="text-align: right;">
            <p class="la la-edit"(click)="edit()"></p>
        </div>
    </div>
</div>
<div *ngIf="libraryCard$ | async as LibraryCard">
    <p-table 
        #dt 
        [value]="histories" 
        [globalFilterFields]="['name','chapter', 'borrowDate', 'endDate']"
        [tableStyle]="{ 'min-width': '75rem' }" 
        [rowHover]="true" 
        dataKey="id"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" 
        [showCurrentPageReport]="true"
        [scrollable]="true" 
        scrollHeight="545px"
    >
        <ng-template pTemplate="caption">
            <div class="justify-content-between align-items-center">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="page-title">Borrow History</h3>
                    <!-- <div class="p-input-icon-left">
                      <i class="la la-search"></i>
                      <input pInputText type="text" (input)="applyFilterGlobal($event, 'contains')" placeholder="Search keyword..."/>
                    </div> -->
                    <div>
                        <button pButton pRipple label="New Record" icon="fa fa-plus" class="btn-primary" (click)="edit()"></button>
                        <button pButton pRipple icon="la la-trash" class="p-button-secondary mx-2"></button>
                    </div>
                </div>
            </div>        
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th>
                    <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                </th>
                <th pSortableColumn="bookName">Book Name <p-sortIcon field="bookName"></p-sortIcon></th>
                <th pSortableColumn="chapter">Chapter <p-sortIcon field="chapter"></p-sortIcon></th>
                <th pSortableColumn="borrowDate">Borrow Date <p-sortIcon field="borrowDate"></p-sortIcon></th>
                <th pSortableColumn="endDate">End Date <p-sortIcon field="endDate"></p-sortIcon></th>
                <th pSortableColumn="status">Status <p-sortIcon field="status"></p-sortIcon></th>
            </tr>
            <!-- <tr>
                <th></th>
                <th>
                    <p-columnFilter type="text" field="bookName"></p-columnFilter>
                </th>
                <th>
                    <p-columnFilter type="text" field="chapter"></p-columnFilter>
                </th>
                <th>
                    <p-columnFilter type="text" field="borrowDate"></p-columnFilter>
                </th>
                <th>
                    <p-columnFilter type="text" field="endDate"></p-columnFilter>
                </th>
                <th>
                    <p-columnFilter type="text" field="status"></p-columnFilter>
                </th>
            </tr> -->
        </ng-template>
        <ng-template pTemplate="body" let-history of LibraryCard>
            <tr>
                <td>
                    <p-tableCheckbox [value]="history"></p-tableCheckbox>
                </td>
                <td>{{ history.bookChapter.book.name }}</td>
                <td>{{ history.bookChapter.chapter }}</td>
                <td>{{ history.borrowDate | date: 'dd/MM/yyyy' }}</td>
                <td>{{ history.endDate | date: 'dd/MM/yyyy' }}</td>
                <td>{{ LibraryCardStatus[history.status] }}</td>
            </tr>
        </ng-template>
        <ng-template pTemplate="summary">
            <div class="flex align-items-center justify-content-between">
                In total there are {{ LibraryCard.borrowHistories?.length}} records.
            </div>
        </ng-template>
    </p-table>
</div>